pipeline {
    agent any
    parameters {
        string(name: 'REGEX_PATTERN', defaultValue: 'v[0-9]+\\.[0-9]+', description: 'Regex to filter tags (e.g., v1.x)')
    }
    environment {
        GIT_REPO_URL = 'https://github.com/lohith21/course-jenkins-project.git'
        GIT_CREDENTIALS = 'github' // Jenkins credential ID
    }
    stages {
        stage('Fetch Git Tags') {
            steps {
                script {
                    // Clone the repository
                    sh """
                    git clone --quiet ${env.GIT_REPO_URL} repo
                    cd repo
                    git fetch --tags
                    """

                    // List all tags matching the regex
                    def tags = sh(
                        script: """
                        cd repo
                        git tag | grep -E '${params.REGEX_PATTERN}' || true
                        """,
                        returnStdout: true
                    ).trim()

                    if (tags) {
                        echo "Matching Tags:"
                        echo tags
                    } else {
                        error("No tags matching the pattern: ${params.REGEX_PATTERN}")
                    }
                }
            }
        }
        stage('Use Selected Tag') {
            steps {
                script {
                    // Example: Use a specific tag for deployment or testing
                    echo "Use tags from the previous stage as needed here."
                }
            }
        }
    }
}
